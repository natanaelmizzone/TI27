"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="fde943ff-7135-5a0c-b45c-634fc2f3df62")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[7981],{533320:(e,a,s)=>{s.d(a,{Ay:()=>h,DA:()=>x,DD:()=>l,IC:()=>m,Jm:()=>n,MV:()=>c,O2:()=>u,QW:()=>j,Vz:()=>d,dd:()=>r,eX:()=>i,fH:()=>f,hL:()=>v,ho:()=>o,ns:()=>_,rf:()=>t});let l="autosave_modal--title--Q-T-o",t="autosave_modal--body--pv4yP",n="autosave_modal--openFilesToSyncText--DI5lk",i="autosave_modal--fileRows--JQWy9",o="autosave_modal--fileRow--vBNLB",r="autosave_modal--userRows--fG3Qq",d="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",c="autosave_modal--onlyFileRowText--NGT-7",u="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",h="autosave_modal--fileMetadata--JIecy",x="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",v="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",f="autosave_modal--expiryWrapper--1Ee1U",m="autosave_modal--expiry--E2Ybr",j="autosave_modal--warningIcon--T1wLu",_="autosave_modal--openToSync--KQUfj"},810755:(e,a,s)=>{s.r(a),s.d(a,{AutosaveLearnMoreModal:()=>c});var l=s(486106),t=s(437088),n=s(521428),i=s(38914),o=s(272243),r=s(303541),d=s(533320);function c(e){let a=t.hS({open:e.open,onClose:e.onClose}),s=(0,l.jsx)(n.$n,{variant:"secondary",onClick:e.onClose,children:(0,r.tx)("autosave.learn_more.done_button")});return(0,l.jsx)(i.bL,{manager:a,width:"lg",children:(0,l.jsxs)(o.vo,{children:[(0,l.jsx)(o.Y9,{children:(0,l.jsx)(o.hE,{children:(0,r.tx)("autosave.learn_more.title")})}),(0,l.jsxs)(o.nB,{children:[(0,l.jsx)("div",{children:(0,r.tx)("autosave.learn_more.body_save_pending_changes")}),(0,l.jsx)("div",{className:d.rf,children:(0,r.tx)("autosave.learn_more.body_use_version_history")})]}),(0,l.jsx)(o.wi,{children:(0,l.jsx)(o.jk,{children:s})})]})})}},110138:(e,a,s)=>{s.r(a),s.d(a,{AutosaveLogOutModal:()=>J,HasAutosaveChangesModal:()=>X});var l=s(486106),t=s(7378),n=s(514228),i=s(656233),o=s(915765),r=s(165054),d=s(521428),c=s(38914),u=s(272243),h=s(437088),x=s(656470),v=s.n(x),f=s(876459),m=s(612521),j=s(11),_=s(714362),g=s(986103),y=s(714743),p=s(204891),N=s(222027),b=s(171275),w=s(589278),A=s(303541),C=s(738636),k=s(156213),L=s(840917),F=s(25189),D=s(327522),S=s(725909),O=s(372672),T=s(612685),E=s(943101),$=s(18613),M=s(915202),U=s(787550),B=s(533320),I=s(619883);function R(e){return e.user?(0,l.jsx)("div",{className:B.O2,children:(0,l.jsx)("p",{children:e.user.community_profile_handle||e.user.email})}):null}async function G(e,a){let s=!1,l=null;try{let{data:t}=await U.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=t.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(s=!0)}catch(e){404===e.status?s=!0:(0,_.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:s,unsyncedFile:a,figFile:l}}let P=(e,a)=>(0,o.s)(()=>{let s=new URL((0,T.r1)(E.F.toLiveGraph(e),!0));s.searchParams.append("fuid",a),m.Ay.redirect(s.toString(),"_blank")}),K=(e,a)=>(0,o.s)(()=>e(C.NA({file:a,openNewFileIn:M.ai.NEW_TAB,source:$.U.AUTOSAVE_MODAL}))),Q=b.y.SMALL;function W(e,a,s){return(0,D.y8)(a)?{fileName:a.file.name,onClick:P(a.file,s.id),thumbnail:(0,l.jsx)(p.NU,{file:a.file,size:Q,borderRadius:4})}:{fileName:a.name,onClick:K(e,a),thumbnail:(0,l.jsx)(N.A,{size:Q,borderRadius:4})}}function Y(e){let{fileName:a,onClick:s,thumbnail:t}=W((0,n.wA)(),e.fileState,e.user);return(0,l.jsxs)("div",{className:B.ho,children:[(0,l.jsx)("div",{className:w.s.hFull.$,children:t}),(0,l.jsxs)("div",{className:B.Ay,children:[(0,l.jsx)("div",{className:B.DA,children:a}),(0,l.jsx)("div",{className:B.hL,children:(0,A.tx)("tile.file_tile.edited_time",{time:(0,l.jsx)(g.h1,{date:e.fileState.lastUpdatedAt})})})]}),(0,l.jsx)("div",{className:B.ns,children:(0,l.jsx)(d.$n,{variant:"secondary",onClick:s,children:(0,A.tx)("autosave.has_changes.open_to_sync")})})]},e.fileState.fileKey)}function H(e){return(0,l.jsx)("div",{className:B.dd,children:Object.keys(e.files).map(a=>(0,l.jsxs)("div",{className:B.eX,children:[(0,l.jsx)(R,{user:e.users.filter(e=>e?.id===a)[0]}),(0,l.jsx)("div",{children:Object.values(e.files[a]).map(s=>(0,l.jsx)(Y,{fileState:s,user:e.users.filter(e=>e?.id===a)[0]},s.fileKey))})]},a))})}function V({modalManager:e,files:a,nextGarbageCollectionTimestamp:s,users:t,includeDismissButton:i,onDone:o}){let r;let h=(0,n.wA)(),x=o||(()=>{h(k.Ce())}),f=Z(s),m=(0,A.tx)("autosave.has_changes.sync_offline_changes"),j=1===v()(Object.values(a)).length,_=null,g=null,p=null,N=null,b=null;if(j){_=v()(Object.values(a))[0];let e=Object.keys(a).filter(e=>a[e].length>0)[0],s=W(h,_,g=t.filter(a=>a?.id===e)[0]);p=s.fileName,N=s.onClick,b=s.thumbnail,r=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R,{user:g}),(0,l.jsxs)("div",{className:B.Vz,children:[(0,l.jsx)("div",{className:w.s.hFull.$,children:b}),(0,l.jsx)("div",{className:B.MV,children:(0,A.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:(0,l.jsx)("span",{className:B.DD,children:p})})})]})]})}else r=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:B.Jm,children:(0,A.tx)("autosave.has_changes.unsynced_changes_offline")}),(0,l.jsx)(H,{files:a,users:t})]});let C=f&&(0,l.jsxs)("div",{className:B.fH,children:[(0,l.jsx)(y.B,{svg:I.A,className:B.QW}),(0,l.jsx)("div",{className:B.IC,children:f})]}),L=i&&(0,l.jsx)(d.$n,{variant:"secondary",onClick:x,children:(0,A.tx)("autosave.has_changes.dismiss.later")}),F=j&&N&&(0,l.jsx)(d.$n,{variant:"primary",onClick:N,children:(0,A.tx)("autosave.has_changes.open_to_sync")});return(0,l.jsx)(c.bL,{manager:e,width:"lg",children:(0,l.jsxs)(u.vo,{children:[(0,l.jsx)(u.Y9,{children:(0,l.jsx)(u.hE,{children:m})}),(0,l.jsx)(u.nB,{children:r}),(C||L||F)&&(0,l.jsxs)(u.wi,{children:[C,(L||F)&&(0,l.jsxs)(u.jk,{children:[L,F]})]})]})})}function X(e){let a=h.hS({open:e.open,onClose:e.onClose}),{unsyncedFiles:s,localUnsyncedFiles:t}=(0,L.Gg)(),i=(0,n.d4)(e=>e.modalShown),o=(0,n.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),r=(0,O.iZ)(),d=r?.id;return i&&d&&r?(0,l.jsx)(V,{modalManager:a,files:{[d]:[...s,...t]},nextGarbageCollectionTimestamp:o,users:[r],includeDismissButton:!0}):null}function z(e){let a=h.hS({open:e.open,onClose:e.onClose}),s=(0,n.wA)(),[i,o]=t.useState(!1),[r,x]=t.useState(!1),v=async()=>{try{for(let a of e.users){let e=a?.id;e&&await (0,L.go)((0,F.cu)(e))}}finally{x(!0)}},m=()=>{o(!0)},j=0===Object.values(e.files).length;if(r||j&&e.loaded){let s=(0,A.tx)("autosave.logout.offline_changes"),t=r?(0,A.tx)("autosave.logout.offline_changes_discarded"):(0,A.tx)("autosave.logout.offline_changes_synced"),n=(0,l.jsx)(d.$n,{variant:"secondary",onClick:e.onLogOut,children:(0,A.tx)("autosave.logout.log_out")});return(0,l.jsx)(c.bL,{width:"md",manager:a,children:(0,l.jsxs)(u.vo,{children:[(0,l.jsx)(u.Y9,{children:(0,l.jsx)(u.hE,{children:s})}),(0,l.jsx)(u.nB,{children:t}),(0,l.jsx)(u.wi,{children:(0,l.jsx)(u.jk,{children:n})})]})})}if(i)return(0,l.jsx)(V,{...e,modalManager:a,onDone:()=>{o(!1)}});{let t,n,i;let o=(0,A.tx)("autosave.has_changes.sync_offline_changes"),r=f.eD?(0,A.t)("autosave.logout.log_out_text.desktop"):(0,A.t)("autosave.logout.log_out_text.web");return f.eD?(t=(0,l.jsx)(d.$n,{variant:"destructiveSecondary",onClick:v,children:(0,A.tx)("autosave.logout.discard_and_logout")}),n=(0,l.jsx)(d.$n,{variant:"secondary",onClick:()=>{s(k.Lo())},children:(0,A.tx)("autosave.logout.cancel")}),i=(0,l.jsx)(d.$n,{variant:"secondary",onClick:m,children:(0,A.tx)("autosave.logout.show_changes")})):(t=(0,l.jsx)(d.$n,{variant:"destructiveSecondary",onClick:v,children:(0,A.tx)("autosave.logout.discard")}),n=(0,l.jsx)(d.$n,{variant:"secondary",onClick:e.onLogOut,children:(0,A.tx)("autosave.logout.log_out")}),i=(0,l.jsx)(d.$n,{variant:"primary",onClick:m,children:(0,A.tx)("autosave.logout.sync_changes")})),(0,l.jsx)(c.bL,{manager:a,width:"lg",children:(0,l.jsxs)(u.vo,{children:[(0,l.jsx)(u.Y9,{children:(0,l.jsx)(u.hE,{children:o})}),(0,l.jsx)(u.nB,{children:r}),(0,l.jsxs)(u.wi,{children:[t,(0,l.jsxs)(u.jk,{children:[n,i]})]})]})})}}function J(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:s,loaded:o,autosaveFilesToDelete:d}=function(e){let a=(0,n.wA)(),[s,l]=t.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return t.useEffect(()=>{let a=async()=>{try{let a=await (0,L.ZW)((0,i.WI)(e.map(e=>e?.id))),s={},t=[],n=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)n.push(G(e,a));for(let a of l.newFiles)e in s||(s[e]=[]),s[e].push(a)}for(let e of(await Promise.all(n))){let a=e.userID;e.shouldDeleteFile?t.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in s||(s[a]=[]),s[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let o=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));l({multiUserGarbageCollectionTimestamp:o,multiUserUnsyncedFiles:s,loaded:!0,autosaveFilesToDelete:t})}catch(e){e instanceof Error?((0,_.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,j.$D)(r.e.SCENEGRAPH_AND_SYNC,e)):(0,j.$D)(r.e.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return S.hp.register(S.a,a),a(),function(){S.hp.unregister(S.a,a)}},[a,e]),s}(e.users);return(0,O.TA)()?(0,l.jsx)(z,{...e,loaded:o,nextGarbageCollectionTimestamp:s,files:a,onLogOut:()=>{for(let e of d)(0,L.go)((0,F.Zt)(e.userID,e.fileKey)).catch(e=>{(0,j.$D)(r.e.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}X.displayName="HasAutosaveChangesModal";let Z=e=>{let a=Math.floor(((0,L.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?(0,A.tx)("autosave.has_changes.expiry_text_shortly"):(0,A.tx)("autosave.has_changes.expiry_text_days",{days:a})};J.displayName="AutosaveLogOutModal"},344566:(e,a,s)=>{s.r(a),s.d(a,{AutosaveNewFileAlreadyOpenModal:()=>v});var l=s(486106),t=s(7378),n=s(514228),i=s(437088),o=s(38914),r=s(272243),d=s(521428),c=s(449184),u=s(589278),h=s(303541),x=s(156213);function v(e){let a=(0,n.wA)();(0,t.useEffect)(()=>(0,c.sx)("New Autosave File Already Open Modal Shown"));let s=()=>a(x.Ce()),v=i.hS({open:!0,onClose:s});return(0,l.jsx)(o.bL,{manager:v,width:360,children:(0,l.jsxs)(r.vo,{children:[(0,l.jsx)(r.Y9,{children:(0,l.jsx)(r.hE,{children:(0,h.tx)("autosave.file_already_open_modal.title")})}),(0,l.jsx)(r.nB,{children:(0,h.tx)("autosave.file_already_open_modal.body",{fileName:(0,l.jsx)("span",{className:u.s.fontSemiBold.$,children:e.file.name})})}),(0,l.jsx)(r.wi,{children:(0,l.jsx)(r.jk,{children:(0,l.jsx)(d.$n,{variant:"secondary",onClick:s,children:(0,h.tx)("general.ok")})})})]})})}v.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=fde943ff-7135-5a0c-b45c-634fc2f3df62

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/b031b1fc571d3288ec0e4087961e336b12946509/1a115cee-a61e64e280c928ce.min.js.map